@startuml
actor Gestore as G
participant "GUI" as UI
participant "Biblioteca" as B
participant "Archiviabile<Utente>" as A
participant "Utente" as U
participant "Matricola" as M
participant "IndirizzoEmail" as E
activate G
' ----- Inizio -----

G -> UI : Interazione con "Utenti"
deactivate G
activate UI
UI -> B : getArchivioUtenti()
activate UI
activate B
B --> UI : restituzione elenco Utenti
deactivate B
deactivate UI
UI -> G : Mostra lista Utenti
activate G

G -> UI : Interazione con "Aggiungi Utente"
deactivate G

UI -> G : Mostra form di registrazione

loop Inserimento fino ad inserimento corretto
    activate G
    G -> UI : Inserisce i dati utente

    activate UI
    UI -> M
    activate M
    M -> M : verifica(matricola)

    M --> UI : matricolaVerificata
    deactivate M

    UI -> E
    activate E
    E -> E : verifica(email)
    E --> UI: emailVerificata
    deactivate E

    break Dati corretti
        UI -> G : Sblocco interazione di conferma
        deactivate UI
    end
end

G -> UI : Conferma registrazione
deactivate G

' ----- Invio dati a Sistema -----
UI -> U : new Utente(nome,cognome,email,matricola)
activate U
U -> UI : nuovo Utente
deactivate U

' ----- Controllo Matricola -----
UI -> A : registra(Utente)
activate A
alt Matricola già registrata

    A -> UI : throw ValoreGiàPresenteException
    deactivate A

    UI -> G : Visualizzazione errore matricola duplicata
else Matricola unica
    activate A


' ----- Conclusione -----
A --> UI : Corretta registrazione
end
deactivate A
UI -> G : Chisura del form di registrazione
deactivate UI
@enduml
